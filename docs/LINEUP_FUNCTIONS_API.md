# API функций проверки и загрузки состава

## Обзор

Модуль содержит функции для работы с составами команд из формы отправки состава Virtual Soccer. Включает проверку наличия состава и его загрузку с подробным логированием.

## Функции

### `checkLineupExists(orderDay)`

Проверяет наличие заполненного состава в форме отправки.

**Параметры:**
- `orderDay` (string) - День матча для проверки состава

**Возвращает:**
- `Promise<boolean>` - true если найден хотя бы один выбранный игрок

**Алгоритм проверки:**
1. Отправляет GET запрос к `mng_order.php?order_day=${orderDay}`
2. Парсит HTML ответ и ищет селекты игроков `select[name^="plr["]`
3. Проверяет каждый селект тремя методами:
   - HTML атрибут `selected` в опциях
   - Свойство `selectedIndex` селекта
   - Свойство `value` селекта
4. Возвращает true если найден хотя бы один валидный игрок

**Логирование:**
- Структурированный вывод с группировкой
- Детали по каждому найденному игроку
- Итоговая статистика проверки

### `loadLineupFromOrder(orderDay)`

Загружает полный состав из формы отправки.

**Параметры:**
- `orderDay` (string) - День матча для загрузки состава

**Возвращает:**
- `Promise<Object|null>` - Объект состава или null при ошибке

**Структура возвращаемого объекта:**
```javascript
{
  lineup: {
    [posIndex]: {
      playerId: string,
      playerName: string,
      position: string
    }
  },
  captain: string|null,
  gameStyle: string,
  orderDay: string
}
```

**Алгоритм загрузки:**
1. Получает HTML форму отправки состава
2. Извлекает игроков из селектов `select[name^="plr["]`
3. Извлекает позиции из селектов `select[name^="pos["]`
4. Определяет капитана из `select[name="captain"]`
5. Определяет стиль игры из селектов стиля
6. Возвращает структурированный объект

**Методы извлечения данных:**
- HTML selected: `option[selected]`
- selectedIndex: `select.selectedIndex`
- select.value: `select.value`

### `getOrderDayFromCurrentPage()`

Извлекает день матча из URL текущей страницы.

**Возвращает:**
- `string|null` - День матча или null если не найден

**Поддерживаемые параметры URL (по приоритету):**
1. `day` - основной параметр в previewmatch.php (например: `?day=25324&match_id=221390`)
2. `preview` - альтернативный параметр
3. `order_day` - прямой параметр

**Логирование:**
- Выводит все найденные параметры URL
- Указывает источник найденного значения
- Детальная диагностика для отладки

### `applyLoadedLineup()`

Применяет загруженный состав в интерфейсе калькулятора.

**Источник данных:**
- localStorage ключ `vs_loaded_lineup`

**Функциональность:**
- Заполняет селекты игроков
- Устанавливает позиции
- Выбирает капитана
- Устанавливает стиль игры
- Очищает localStorage после применения

## Обработка ошибок

Все функции включают обработку ошибок с подробным логированием:
- Сетевые ошибки
- Ошибки парсинга HTML
- Отсутствие данных
- Некорректные параметры

## Совместимость

Поддерживаются все домены Virtual Soccer:
- virtualsoccer.ru
- vfleague.com
- vfliga.ru
- vfliga.com

## Логирование

Все функции используют структурированное логирование:
- Группировка сообщений с `console.group()`
- Эмодзи для категоризации сообщений
- Подробная статистика выполнения
- Информация о методах извлечения данных