# Финальные координаты позиционирования на поле

## Версия: 0.932

## Параметры системы

```javascript
FIELD_LAYOUT = {
    FIELD_WIDTH: 400,
    FIELD_HEIGHT: 566,
    CONTAINER_PADDING: 0,      // Отступы убраны
    WORKING_WIDTH: 400,        // Полная ширина
    WORKING_HEIGHT: 566,       // Полная высота
    SHIRT_WIDTH: 40,
    SHIRT_HEIGHT: 34
}
```

## Координаты зон (Y-axis)

### Домашняя команда (снизу вверх):

| Линия | Центр (top) | Верхний край | Нижний край | Интервал до след. |
|-------|-------------|--------------|-------------|-------------------|
| gk | 549 | 532 | 566 ✅ | - |
| def | 499 | 482 | 516 | 50px |
| semidef | 475 | 458 | 492 | 24px |
| mid | 449 | 432 | 466 | 26px |
| semiatt | 424 | 407 | 441 | 25px |
| att | 339 | 322 | 356 | 85px |

**Особенности:**
- GK максимально прижат к нижнему краю (нижний край футболки = 566px)
- Неравномерные интервалы для оптимального распределения
- Большой интервал между semiatt и att (85px) для избежания пересечений

### Гостевая команда (сверху вниз):

| Линия | Центр (top) | Верхний край | Нижний край | Интервал до след. |
|-------|-------------|--------------|-------------|-------------------|
| gk | 67 | 50 ⚠️ | 84 | - |
| def | 127 | 110 | 144 | 60px |
| semidef | 157 | 140 | 174 | 30px |
| mid | 202 | 185 | 219 | 45px |
| semiatt | 232 | 215 | 249 | 30px |
| att | 277 | 260 | 294 | 45px |

**Особенности:**
- GK имеет отступ 50px от верха (эмпирическая корректировка)
- Неравномерные интервалы для оптимального распределения
- Меньшие интервалы между линиями по сравнению с домашней командой

## Проверка пересечений

### ✅ Между командами:

```
Домашняя att (верхний край): 322px
Гостевая att (нижний край): 294px
Зазор: 322 - 294 = 28px ✅
```

**Вывод:** Нападающие НЕ пересекаются, есть комфортный зазор 28px.

### ✅ Внутри команд:

Все линии имеют достаточные интервалы (минимум 24px), футболки не пересекаются.

## Асимметрия координат

### Почему гостевой GK на 67px, а не на 17px?

**Теоретический расчёт:**
```
Для прижатия к верху:
  Центр: 0 + 17 = 17px
  Верхний край: 17 - 17 = 0px ✅
```

**Практическая проблема:**
При `gk: 17` футболка **выходит за верхнюю границу** поля из-за:
- Особенностей рендеринга браузера
- CSS overflow
- Округления координат
- Transform origin

**Эмпирическое решение:**
```
gk: 67px
Верхний край: 67 - 17 = 50px
Отступ от верха: 50px
```

Это значение подобрано **экспериментально** и обеспечивает корректное визуальное отображение без выхода за границы.

### Почему домашний GK работает на 549px?

Домашний GK прижат к **нижнему** краю, и там нет проблем с рендерингом:
```
gk: 549px
Нижний край: 549 + 17 = 566px ✅ Точно на границе
```

**Вывод:** Асимметрия вызвана техническими особенностями браузерного рендеринга верхней границы.

## Визуализация

```
0px   ┌─────────────────────────────────┐
      │                                  │
50px  │  ┌──────┐ GK (гости)             │ ⚠️ Отступ 50px
67px  │  │  GK  │                        │
84px  │  └──────┘                        │
      │                                  │
110px │  ┌──────┐ def                    │
127px │  │      │                        │
144px │  └──────┘                        │
      │                                  │
140px │  ┌──────┐ semidef                │
157px │  │      │                        │
174px │  └──────┘                        │
      │                                  │
185px │  ┌──────┐ mid                    │
202px │  │      │                        │
219px │  └──────┘                        │
      │                                  │
215px │  ┌──────┐ semiatt                │
232px │  │      │                        │
249px │  └──────┘                        │
      │                                  │
260px │  ┌──────┐ att (гости)            │
277px │  │      │                        │
294px │  └──────┘                        │
      │  ═══════════════════════════════ │
      │  ✅ ЗАЗОР 28px                   │
      │  ═══════════════════════════════ │
322px │  ┌──────┐ att (хозяева)          │
339px │  │      │                        │
356px │  └──────┘                        │
      │                                  │
407px │  ┌──────┐ semiatt                │
424px │  │      │                        │
441px │  └──────┘                        │
      │                                  │
432px │  ┌──────┐ mid                    │
449px │  │      │                        │
466px │  └──────┘                        │
      │                                  │
458px │  ┌──────┐ semidef                │
475px │  │      │                        │
492px │  └──────┘                        │
      │                                  │
482px │  ┌──────┐ def                    │
499px │  │      │                        │
516px │  └──────┘                        │
      │                                  │
532px │  ┌──────┐ GK (хозяева)           │
549px │  │  GK  │                        │ ✅ Прижат
566px │  └──────┘                        │
      └─────────────────────────────────┘
```

## Код

### generateFieldPositionsWithFlankPreservation()

```javascript
const zones = isHome ? {
    gk: 549,      // 566 - 17 (максимально прижат к низу)
    def: 499,     // Защитная линия
    semidef: 475, // Полузащитная линия
    mid: 449,     // Средняя линия
    semiatt: 424, // Полуатакующая линия
    att: 339      // Атакующая линия
} : {
    gk: 67,       // Эмпирическая корректировка (отступ 50px)
    def: 127,     // Защитная линия
    semidef: 157, // Полузащитная линия
    mid: 202,     // Средняя линия
    semiatt: 232, // Полуатакующая линия
    att: 277      // Атакующая линия
};
```

### generateFieldPositions()

Аналогичные координаты используются во второй функции генерации позиций.

## Итоги

### ✅ Достигнуто:

1. **Домашний GK максимально прижат** к нижнему краю (0px отступ)
2. **Гостевой GK корректно отображается** (50px отступ из-за технических ограничений)
3. **Нет пересечений** между командами (зазор 28px)
4. **Нет пересечений** внутри команд (минимум 24px между линиями)
5. **Оптимальное распределение** игроков по полю

### ⚠️ Компромиссы:

1. **Асимметрия GK:** Домашний прижат (0px), гостевой с отступом (50px)
2. **Неравномерные интервалы:** Для избежания пересечений и оптимального распределения

### 📊 Статистика:

- **Рабочая область:** 400×566px (100% поля)
- **Отступы контейнера:** 0px
- **Минимальный зазор между командами:** 28px
- **Минимальный интервал между линиями:** 24px
- **Максимальный интервал между линиями:** 85px

## Связанные документы

- `docs/FIELD_POSITIONING_SYSTEM.md` - полная документация системы
- `docs/REMOVE_CONTAINER_PADDING.md` - отчёт об удалении отступов
- `docs/REFACTOR_FIELD_LAYOUT_CONSTANTS.md` - рефакторинг констант
