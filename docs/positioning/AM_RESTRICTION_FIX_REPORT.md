# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è AM –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ LW/RW

## –ü—Ä–æ–±–ª–µ–º–∞
AM –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–∞–∂–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ LW –Ω–∞ –ø–æ–ª–µ, —Ö–æ—Ç—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª—É: "AM –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –µ—Å–ª–∏ –µ—Å—Ç—å RW –∏–ª–∏ LW (–∏–ª–∏ –æ–±–∞)".

## –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
–ò–∑ –ª–æ–≥–æ–≤ `examples/console-export-2026-1-4_21-36-7.log` –≤–∏–¥–Ω–æ:
1. **–ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: `hasLW: false, hasRW: false` - AM –¥–æ—Å—Ç—É–ø–µ–Ω ‚úÖ
2. **–ü–æ—Å–ª–µ LM‚ÜíLW**: `hasLW: true, hasRW: false` - AM –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–µ–Ω ‚ùå
3. **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–π –¥—Ä—É–≥–∏—Ö –ø–æ–∑–∏—Ü–∏–π

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –∫–æ–¥–µ

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–ø—Ü–∏–π
–í —Ñ—É–Ω–∫—Ü–∏–∏ `onMiniPositionChange` –Ω–µ –±—ã–ª–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –æ–ø—Ü–∏–π –¥–ª—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

### 2. –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ case 'CM'
```javascript
// –ë–´–õ–û (–∏–∑–±—ã—Ç–æ—á–Ω–æ):
if (noLWandRW && amAbsent && isMaxCM && noLW && noRW) {

// –°–¢–ê–õ–û (—É–ø—Ä–æ—â–µ–Ω–æ):
if (!hasLW && !hasRW && amAbsent && isMaxCM) {
```

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–π (calc.user.js:4420-4440)
```javascript
// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ –¥–ª—è –í–°–ï–• –ø–æ–∑–∏—Ü–∏–π –ø–æ—Å–ª–µ –ª—é–±–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
if (lineup) {
    newPositions.forEach((pos, idx) => {
        if (lineup[idx] && lineup[idx].miniPositionSelect && idx !== rowIndex) {
            const updatedOpts = getAllowedMiniOptions({
                formationName,
                positions: newPositions,
                rowIndex: idx
            });
            lineup[idx].miniPositionSelect.setOptions(updatedOpts);
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω–æ
            const currentValue = lineup[idx].miniPositionSelect.getValue();
            const isCurrentValueStillValid = updatedOpts.some(opt => opt.value === currentValue);
            if (!isCurrentValueStillValid) {
                // –ï—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±–æ–ª—å—à–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é –æ–ø—Ü–∏—é
                lineup[idx].miniPositionSelect.setValue(updatedOpts[0]?.value || pos);
            }
        }
    });
}
```

### 2. –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è CM –ø–æ–∑–∏—Ü–∏–π (calc.user.js:3860-3875)
```javascript
// AM –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ù–ï–¢ LW –ò –ù–ï–¢ RW
if (!hasLW && !hasRW && amAbsent && isMaxCM) {
    console.log(`[PositionLogic] ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º AM –¥–ª—è CM –ø–æ–∑–∏—Ü–∏–∏ ${rowIndex}`);
    add(options, 'AM');
} else {
    console.log(`[PositionLogic] ‚ùå –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º AM –¥–ª—è CM –ø–æ–∑–∏—Ü–∏–∏ ${rowIndex}`);
}
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (calc.user.js:3770-3775)
```javascript
// –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê: –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ LW/RW –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
if (hasLW || hasRW) {
    console.log(`[getAllowedMiniOptions] üö® –í–ù–ò–ú–ê–ù–ò–ï: –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫—Ä–∞–π–Ω–∏–µ –Ω–∞–ø–∞–¥–∞—é—â–∏–µ!`);
    console.log(`[getAllowedMiniOptions] LW –ø–æ–∑–∏—Ü–∏–∏:`, positions.map((pos, idx) => pos === 'LW' ? idx : null).filter(x => x !== null));
    console.log(`[getAllowedMiniOptions] RW –ø–æ–∑–∏—Ü–∏–∏:`, positions.map((pos, idx) => pos === 'RW' ? idx : null).filter(x => x !== null));
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç
–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, RM‚ÜíRW) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ–ø—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –¥—Ä—É–≥–∏—Ö –ø–æ–∑–∏—Ü–∏–π, –≤–∫–ª—é—á–∞—è CM/DM, —á—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å AM –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ LW –∏–ª–∏ RW.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test-am-restriction.html` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π AM.

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
–ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é AM –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ LW/RW —Ä–µ—à–µ–Ω–∞ –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–ø—Ü–∏–π –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏.