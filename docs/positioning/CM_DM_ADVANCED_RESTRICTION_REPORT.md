# –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ CM‚ÜíDM –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã—Ö –ø–æ–ª—É–∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ
–î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –µ—Å–ª–∏ DM –µ—Å—Ç—å –Ω–∞ –ø–æ–ª–µ, –∞ —Å—É–º–º–∞ CM + AM < 2, —Ç–æ CM —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º –Ω–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å DM.

## –õ–æ–≥–∏–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –¶–µ–ª—å
–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –ø–æ–ª—è –æ—Å—Ç–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –ø–æ–ª—É–∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤. –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –æ–ø–æ—Ä–Ω–∏–∫ (DM) –∏ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã—Ö –ø–æ–ª—É–∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤ (CM + AM) –º–µ–Ω—å—à–µ 2, —Ç–æ –Ω–µ–ª—å–∑—è –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ CM –≤ –µ—â–µ –æ–¥–Ω–æ–≥–æ DM.

### –£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
1. **DM > 0** - –Ω–∞ –ø–æ–ª–µ —É–∂–µ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –æ–ø–æ—Ä–Ω–∏–∫
2. **CM + AM < 2** - —Å—É–º–º–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã—Ö –∏ –∞—Ç–∞–∫—É—é—â–∏—Ö –ø–æ–ª—É–∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤ –º–µ–Ω—å—à–µ 2
3. **rowIndex === cmMax** - —Ç–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è —è–≤–ª—è–µ—Ç—Å—è CM —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
–ù–æ–≤–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏–º–µ–µ—Ç **–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç** –∏ –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ, –¥–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏:

```javascript
// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
if ((dmCount < 2) && cmCount > 2 && (rowIndex === cmMin1 || rowIndex === cmMin2)) cmToDMAllowed = true;
if ((dmCount < 2) && cmCount === 2 && rowIndex !== cmMax) cmToDMAllowed = true;
if ((dmCount < 2) && cmCount === 1) cmToDMAllowed = true;

// –ó–∞—Ç–µ–º –Ω–æ–≤–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥
if (dmCount > 0 && centralMidfielders < 2 && rowIndex === cmMax) {
    cmToDMAllowed = false; // –ë–ª–æ–∫–∏—Ä—É–µ–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—Ä–∞–≤–∏–ª
}
```

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –ø–æ–ª—É–∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤
**–§–æ—Ä–º–∞—Ü–∏—è**: 4-1-3-2  
**–ü–æ–∑–∏—Ü–∏–∏**: `['GK', 'LD', 'CD', 'CD', 'RD', 'DM', 'CM', 'LW', 'RW', 'CF', 'CF']`
- DM = 1, CM = 1, AM = 0
- CM + AM = 1 < 2 ‚ùå
- CM –Ω–∞ –∏–Ω–¥–µ–∫—Å–µ 6 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π) **–ù–ï –º–æ–∂–µ—Ç** —Å—Ç–∞—Ç—å DM

### –ü—Ä–∏–º–µ—Ä 2: –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ
**–§–æ—Ä–º–∞—Ü–∏—è**: 4-1-2-3  
**–ü–æ–∑–∏—Ü–∏–∏**: `['GK', 'LD', 'CD', 'CD', 'RD', 'DM', 'CM', 'AM', 'LW', 'CF', 'RW']`
- DM = 1, CM = 1, AM = 1  
- CM + AM = 2 = 2 ‚úÖ
- CM –Ω–∞ –∏–Ω–¥–µ–∫—Å–µ 6 **–º–æ–∂–µ—Ç** —Å—Ç–∞—Ç—å DM

### –ü—Ä–∏–º–µ—Ä 3: –ù–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç –±–µ–∑ DM –Ω–∞ –ø–æ–ª–µ
**–§–æ—Ä–º–∞—Ü–∏—è**: 4-4-2  
**–ü–æ–∑–∏—Ü–∏–∏**: `['GK', 'LD', 'CD', 'CD', 'RD', 'LM', 'CM', 'RM', 'AM', 'CF', 'CF']`
- DM = 0 (–Ω–µ—Ç DM –Ω–∞ –ø–æ–ª–µ)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ **–Ω–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç**, –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### –ü—Ä–∏–º–µ—Ä 4: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º CM=2
**–§–æ—Ä–º–∞—Ü–∏—è**: 4-1-4-1  
**–ü–æ–∑–∏—Ü–∏–∏**: `['GK', 'LD', 'CD', 'CD', 'RD', 'DM', 'CM', 'CM', 'LW', 'RW', 'CF']`
- DM = 1, CM = 2, AM = 0
- CM + AM = 2 = 2 ‚úÖ (–Ω–æ–≤–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç)
- –ù–æ CM –Ω–∞ –∏–Ω–¥–µ–∫—Å–µ 7 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π) **–ù–ï –º–æ–∂–µ—Ç** —Å—Ç–∞—Ç—å DM –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è "CM=2"

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ CM‚ÜíDM (calc.user.js:3856-3876)
```javascript
// –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï 2: –ï—Å–ª–∏ DM –µ—Å—Ç—å –Ω–∞ –ø–æ–ª–µ, –∞ —Å—É–º–º–∞ CM + AM < 2, —Ç–æ CM —Å –º–∞–∫—Å –∏–Ω–¥–µ–∫—Å–æ–º –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å DM
const amCount = counts['AM'] || 0;
const centralMidfielders = cmCount + amCount;
if (dmCount > 0 && centralMidfielders < 2 && rowIndex === cmMax) {
    cmToDMAllowed = false;
    console.log(`[PositionLogic] üö´ CM —Å –º–∞–∫—Å –∏–Ω–¥–µ–∫—Å–æ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: DM=${dmCount}, CM+AM=${centralMidfielders}`);
}
```

### 2. –†–∞—Å—à–∏—Ä–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (calc.user.js:3872-3876)
```javascript
console.log(`[PositionLogic] CM‚ÜíDM –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏ ${rowIndex}:`, {
    dmCount, cmCount, amCount, centralMidfielders, cmMin1, cmMax, 
    isMaxCM: rowIndex === cmMax,
    canBecomeDM: cmToDMAllowed
});
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test-cm-dm-advanced-restriction.html` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:
- ‚úÖ DM=1, CM+AM=1 ‚Üí CM —Å –º–∞–∫—Å –∏–Ω–¥–µ–∫—Å–æ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- ‚úÖ DM=1, CM+AM=2 ‚Üí CM –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å DM  
- ‚úÖ DM=0 ‚Üí –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç
- ‚úÖ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º CM=2

## –°—Ç–∞—Ç—É—Å: ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ "CM —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å DM –µ—Å–ª–∏ DM –µ—Å—Ç—å –∏ CM+AM < 2" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –ª–æ–≥–∏–∫—É `getAllowedMiniOptions` —Å –≤—ã—Å—à–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º.