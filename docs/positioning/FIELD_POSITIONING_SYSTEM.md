# Система позиционирования футболок на поле

## Обзор

Система позиционирования отвечает за размещение иконок игроков (футболок) на визуальном представлении футбольного поля в калькуляторе. Система учитывает формацию команды, фланговую принадлежность позиций и обеспечивает корректное отображение без выхода за границы поля и пересечений.

**Текущая версия:** 0.932  
**Отступы контейнера:** 0px (убраны для максимального прижатия к краям)  
**Рабочая область:** 400×566px (полный размер поля)

## Архитектура системы

### 1. Константы позиционирования

В коде определён объект `FIELD_LAYOUT` с ключевыми параметрами:

```javascript
const FIELD_LAYOUT = {
    // Размеры внешнего контейнера (фон поля)
    FIELD_WIDTH: 400,
    FIELD_HEIGHT: 566,
    
    // Отступы контейнера футболок от краёв фона
    // Это значение определяет, насколько внутренний контейнер меньше внешнего
    CONTAINER_PADDING: 34,  // ← Магическое число, выбранное эмпирически
    
    // Размеры рабочей области (вычисляются автоматически)
    get WORKING_WIDTH() { return this.FIELD_WIDTH - this.CONTAINER_PADDING * 2; },   // 332px
    get WORKING_HEIGHT() { return this.FIELD_HEIGHT - this.CONTAINER_PADDING * 2; }, // 498px
    
    // Размеры футболок
    SHIRT_WIDTH: 40,
    SHIRT_HEIGHT: 34,
    
    // Половинные размеры (для центрирования)
    get SHIRT_HALF_WIDTH() { return this.SHIRT_WIDTH / 2; },   // 20px
    get SHIRT_HALF_HEIGHT() { return this.SHIRT_HEIGHT / 2; }  // 17px
};
```

**Откуда взялось 34px?**

Значение `CONTAINER_PADDING = 34px` было выбрано **эмпирически** (на глаз) при создании системы. Это отступ от краёв фонового изображения поля, который:
1. Создаёт визуальный отступ от рамки поля на картинке
2. Предотвращает наложение футболок на зелёную рамку
3. Обеспечивает эстетичное расположение иконок

**Важно:** Это не связано с какими-то размерами на изображении - просто значение, которое хорошо выглядит визуально.

### 2. Структура контейнеров

Система использует вложенные контейнеры:

#### Внешний контейнер (фон поля)
```javascript
fieldCol.style.width = '400px';  // FIELD_LAYOUT.FIELD_WIDTH
fieldCol.style.height = '566px'; // FIELD_LAYOUT.FIELD_HEIGHT
fieldCol.style.background = "url('field_01.webp')";
```

**Размер:** 400px × 566px  
**Содержимое:** Фоновое изображение футбольного поля

#### Внутренний контейнер (для футболок)
```javascript
const padding = FIELD_LAYOUT.CONTAINER_PADDING; // 34px
shirtsContainer.style.cssText = 
    `position: absolute; top: ${padding}px; left: ${padding}px; right: ${padding}px; bottom: ${padding}px;`;
```

**Отступы:** 34px со всех сторон (FIELD_LAYOUT.CONTAINER_PADDING)  
**Размер:** 332px × 498px (FIELD_LAYOUT.WORKING_WIDTH × FIELD_LAYOUT.WORKING_HEIGHT)  
**Назначение:** Рабочая область для размещения футболок

#### Футболки (иконки игроков)
```javascript
div.style.cssText = `
    position: absolute;
    width: ${FIELD_LAYOUT.SHIRT_WIDTH}px;   // 40px
    height: ${FIELD_LAYOUT.SHIRT_HEIGHT}px; // 34px
    top: ${top}px;
    left: ${left}px;
    transform: translate(-50%, -50%);
`;
```

**Размер:** 40px × 34px (FIELD_LAYOUT.SHIRT_WIDTH × FIELD_LAYOUT.SHIRT_HEIGHT)  
**Позиционирование:** Координаты указывают на центр футболки (благодаря `transform: translate(-50%, -50%)`)  
**Родитель:** `shirtsContainer` (332×498px)

### 3. Параметры рабочей области

```javascript
const fieldWidth = 332;   // Ширина shirtsContainer
const fieldHeight = 498;  // Высота shirtsContainer
```

**Важно:** Все координаты футболок рассчитываются относительно `shirtsContainer`, а не внешнего контейнера!

### 3. Визуальная схема вложенности

```
┌─────────────────────────────────────────────────────────┐
│  fieldCol (400px × 566px)                               │
│  ┌─ Фон: field_01.webp ─────────────────────────────┐  │
│  │                                                    │  │
│  │  ↕ 34px отступ сверху                             │  │
│  │                                                    │  │
│  │  ┌──────────────────────────────────────────┐    │  │
│  │  │ shirtsContainer (332px × 498px)          │    │  │
│  │  │                                           │    │  │
│  │←─┼─→  ← Координаты футболок считаются      │←──→│  │
│ 34px │    относительно этого контейнера!       │ 34px  │
│  │  │                                           │    │  │
│  │  │  ┌──────┐  ← Футболка (40×34px)          │    │  │
│  │  │  │ GK   │    top: 497px, left: 166px     │    │  │
│  │  │  └──────┘    (центр футболки)            │    │  │
│  │  │                                           │    │  │
│  │  └──────────────────────────────────────────┘    │  │
│  │                                                    │  │
│  │  ↕ 34px отступ снизу                              │  │
│  │                                                    │  │
│  └────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

**Ключевые моменты:**
1. Фон поля (400×566px) - это внешний контейнер
2. Футболки размещаются в `shirtsContainer` (332×498px) с отступами 34px
3. Координаты `top` и `left` указывают на **центр** футболки (из-за `transform: translate(-50%, -50%)`)
4. Поэтому минимальная координата центра = половина размера футболки (20px для X, 17px для Y)

### 4. Размеры футболок

```javascript
const SHIRT_WIDTH = 40;        // Ширина иконки футболки
const SHIRT_HEIGHT = 34;       // Высота иконки футболки
const SHIRT_HALF_WIDTH = 20;   // Половина ширины (для центрирования)
const SHIRT_HALF_HEIGHT = 17;  // Половина высоты (для центрирования)
```

**Центрирование:** Футболки используют `transform: translate(-50%, -50%)`, поэтому координаты указывают на центр иконки.

### 3. Безопасные границы

Чтобы футболки не выходили за пределы поля, применяются ограничения:

```javascript
const MIN_X = SHIRT_HALF_WIDTH;              // 20px
const MAX_X = fieldWidth - SHIRT_HALF_WIDTH; // 312px (332 - 20)
const MIN_Y = SHIRT_HALF_HEIGHT;             // 17px
const MAX_Y = fieldHeight - SHIRT_HALF_HEIGHT; // 481px (498 - 17)
```

**Рабочая зона для центров футболок:**
- **X:** от 20px до 312px (292px ширина)
- **Y:** от 17px до 481px (464px высота)

## Основные функции

### 1. `generateFieldPositionsWithFlankPreservation(formation, side, previousFormation)`

**Назначение:** Основная функция генерации позиций с учетом фланговой принадлежности.

**Параметры:**
- `formation` (Array) - массив позиций игроков, например: `['GK', 'LD', 'CD', 'RD', 'CM', 'ST']`
- `side` (string) - сторона команды: `'home'` или `'away'`
- `previousFormation` (Array, optional) - предыдущая формация (для будущей системы стабильности)

**Возвращает:**
- (Array) - массив объектов с координатами: `[{position: 'GK', top: 497, left: 166}, ...]`

**Алгоритм работы:**

#### Шаг 1: Определение зон по вертикали

Зоны определяют Y-координаты для каждой тактической линии:

```javascript
const zones = isHome ? {
    gk: 549,      // 566 - 17 (максимально прижат к низу)
    def: 499,     // Защитная линия
    semidef: 475, // Полузащитная линия (опорники, вингбеки)
    mid: 449,     // Средняя линия
    semiatt: 424, // Полуатакующая линия (атакующие полузащитники, вингеры)
    att: 339      // Атакующая линия (нападающие)
} : {
    gk: 67,       // 0 + 67 (отступ 50px от верха)
    def: 127,     // Защитная линия
    semidef: 157, // Полузащитная линия
    mid: 202,     // Средняя линия
    semiatt: 232, // Полуатакующая линия
    att: 277      // Атакующая линия
};
```

**Домашняя команда:** Позиции отсчитываются снизу вверх (вратарь внизу, прижат к краю)  
**Гостевая команда:** Позиции отсчитываются сверху вниз (вратарь вверху, отступ 50px)

**⚠️ Важно:** Гостевой GK имеет отступ 50px от верха (координата 67px вместо теоретических 17px) из-за особенностей рендеринга браузера. При значении 17px футболка выходит за верхнюю границу поля. Это эмпирически подобранное значение для корректного отображения.

**Интервалы между линиями:**
- Домашняя: 24-85px (неравномерные для оптимального распределения)
- Гостевая: 30-60px (неравномерные для оптимального распределения)

**Зазор между att линиями:** 28px (322 - 294 = 28px) ✅ Нет пересечений

#### Шаг 2: Группировка игроков по линиям

Каждая позиция относится к определенной тактической линии:

```javascript
const lines = {
    gk: [],      // GK
    def: [],     // LD, CD, RD, SW
    semidef: [], // DM, LB, RB
    mid: [],     // LM, CM, RM
    semiatt: [], // AM, FR, RW, LW
    att: []      // LF, CF, RF, ST
};

formation.forEach((pos, idx) => {
    const flank = getPositionFlank(pos); // 'left', 'center', 'right'
    const playerInfo = { pos, idx, flank };
    
    // Распределение по линиям
    if (pos === 'GK') lines.gk.push(playerInfo);
    else if (['LD', 'CD', 'RD', 'SW'].includes(pos)) lines.def.push(playerInfo);
    else if (['DM', 'LB', 'RB'].includes(pos)) lines.semidef.push(playerInfo);
    // ... и т.д.
});
```

#### Шаг 3: Определение фланговой принадлежности

Каждая позиция имеет фланговую принадлежность:

```javascript
const POSITION_FLANKS = {
    // Левый фланг
    'LD': 'left', 'LB': 'left', 'LM': 'left', 'LW': 'left', 'LF': 'left',
    
    // Правый фланг
    'RD': 'right', 'RB': 'right', 'RM': 'right', 'RW': 'right', 'RF': 'right',
    
    // Центр
    'GK': 'center', 'SW': 'center', 'CD': 'center', 'DM': 'center',
    'CM': 'center', 'AM': 'center', 'FR': 'center', 'CF': 'center', 'ST': 'center'
};
```

#### Шаг 4: Распределение по горизонтали (функция `distributeByFlanks`)

Для каждой линии игроки распределяются по горизонтали с учетом их флангов:

```javascript
function distributeByFlanks(playersInfo) {
    // Группируем по флангам
    const leftPlayers = playersInfo.filter(p => p.flank === 'left');
    const centerPlayers = playersInfo.filter(p => p.flank === 'center');
    const rightPlayers = playersInfo.filter(p => p.flank === 'right');
    
    // Рассчитываем координаты для каждой группы
    const coords = calculateFlankCoordinates(
        leftPlayers.length, 
        centerPlayers.length, 
        rightPlayers.length
    );
    
    return result;
}
```

**Логика распределения координат:**

##### Левый фланг
```javascript
if (leftCount === 1) {
    coords.left = [margin + usableWidth * 0.1]; // 10% от ширины ≈ 43px
} else if (leftCount > 1) {
    // Распределяем в зоне 5-20%
    for (let i = 0; i < leftCount; i++) {
        const x = margin + usableWidth * (0.05 + (0.15 / (leftCount - 1)) * i);
        coords.left.push(x);
    }
}
```

##### Правый фланг
```javascript
if (rightCount === 1) {
    coords.right = [margin + usableWidth * 0.9]; // 90% от ширины ≈ 300px
} else if (rightCount > 1) {
    // Распределяем в зоне 80-95%
    for (let i = 0; i < rightCount; i++) {
        const x = margin + usableWidth * (0.8 + (0.15 / (rightCount - 1)) * i);
        coords.right.push(x);
    }
}
```

##### Центр
```javascript
if (centerCount === 1) {
    coords.center = [fieldWidth / 2]; // Точный центр = 166px
} else if (centerCount === 2) {
    coords.center = [
        margin + usableWidth * 0.35, // 35% ≈ 119px
        margin + usableWidth * 0.65  // 65% ≈ 213px
    ];
} else if (centerCount === 3) {
    coords.center = [
        margin + usableWidth * 0.3,  // 30% ≈ 103px
        fieldWidth / 2,              // 50% = 166px
        margin + usableWidth * 0.7   // 70% ≈ 229px
    ];
} else if (centerCount > 3) {
    // Равномерно в зоне 25-75%
    const centerZoneStart = margin + usableWidth * 0.25;
    const centerZoneWidth = usableWidth * 0.5;
    for (let i = 0; i < centerCount; i++) {
        const x = centerZoneStart + (centerZoneWidth / (centerCount - 1)) * i;
        coords.center.push(x);
    }
}
```

#### Шаг 5: Зеркалирование для гостевой команды

```javascript
positionsWithPlayers.forEach(({ player, x }) => {
    // Зеркалируем координаты для гостевой команды
    const finalX = isHome ? x : (fieldWidth - x);
    
    positions[player.idx] = {
        position: player.pos,
        top: zone,
        left: finalX
    };
});
```

**Логика:**
- **Домашняя команда:** координаты X остаются как есть
- **Гостевая команда:** `finalX = 332 - x` (зеркальное отражение)

#### Шаг 6: Применение ограничений координат

Финальный этап - ограничение координат безопасными границами:

```javascript
positions.forEach(pos => {
    if (pos) {
        pos.left = Math.max(MIN_X, Math.min(MAX_X, pos.left));
        pos.top = Math.max(MIN_Y, Math.min(MAX_Y, pos.top));
    }
});
```

Это гарантирует, что ни одна футболка не выйдет за границы поля.

### 2. `generateFieldPositions(formation, side)`

**Назначение:** Упрощенная функция генерации позиций без учета фланговой принадлежности (legacy).

**Отличия от `generateFieldPositionsWithFlankPreservation`:**
- Не учитывает фланговую принадлежность при распределении
- Использует простое равномерное распределение по горизонтали
- Применяется как fallback для совместимости

**Алгоритм распределения:**

```javascript
function distributeHorizontally(count) {
    const margin = 10;
    const usableWidth = fieldWidth - 2 * margin;
    
    if (count === 1) return [fieldWidth / 2];
    if (count === 2) return [margin + usableWidth * 0.25, margin + usableWidth * 0.75];
    if (count === 3) return [margin, fieldWidth / 2, fieldWidth - margin];
    
    // Для 4+ игроков - равномерное распределение
    const positions = [];
    for (let i = 0; i < count; i++) {
        positions.push(margin + (usableWidth / (count - 1)) * i);
    }
    return positions;
}
```

## Примеры работы

### Пример 1: Формация 4-4-2 (домашняя команда)

**Формация:** `['GK', 'LD', 'CD', 'CD', 'RD', 'LM', 'CM', 'CM', 'RM', 'ST', 'ST']`

**Результат:**

| Позиция | Линия | Фланг | Y (top) | X (left) | Описание |
|---------|-------|-------|---------|----------|----------|
| GK | gk | center | 497 | 166 | Центр вратарской зоны |
| LD | def | left | 450 | 10 | Левый край защиты |
| CD | def | center | 450 | 119 | Левый центральный защитник |
| CD | def | center | 450 | 213 | Правый центральный защитник |
| RD | def | right | 450 | 322 | Правый край защиты |
| LM | mid | left | 355 | 43 | Левый полузащитник (10%) |
| CM | mid | center | 355 | 119 | Левый центральный полузащитник (35%) |
| CM | mid | center | 355 | 213 | Правый центральный полузащитник (65%) |
| RM | mid | right | 355 | 289 | Правый полузащитник (90%) |
| ST | att | center | 265 | 119 | Левый нападающий (35%) |
| ST | att | center | 265 | 213 | Правый нападающий (65%) |

### Пример 2: Формация 3-5-2 (гостевая команда)

**Формация:** `['GK', 'CD', 'SW', 'CD', 'LM', 'CM', 'DM', 'CM', 'RM', 'ST', 'ST']`

**Результат (до зеркалирования):**

| Позиция | Линия | Фланг | Y (top) | X (left, до) | X (left, после) | Описание |
|---------|-------|-------|---------|--------------|-----------------|----------|
| GK | gk | center | 51 | 166 | 166 | Центр (симметрично) |
| CD | def | center | 100 | 103 | 229 | Левый защитник → правый |
| SW | def | center | 100 | 166 | 166 | Центральный (симметрично) |
| CD | def | center | 100 | 229 | 103 | Правый защитник → левый |
| LM | mid | left | 200 | 43 | 289 | Левый → правый фланг |
| CM | mid | center | 200 | 103 | 229 | Левый центр → правый центр |
| DM | mid | center | 200 | 166 | 166 | Центр (симметрично) |
| CM | mid | center | 200 | 229 | 103 | Правый центр → левый центр |
| RM | mid | right | 200 | 289 | 43 | Правый → левый фланг |
| ST | att | center | 300 | 119 | 213 | Левый → правый нападающий |
| ST | att | center | 300 | 213 | 119 | Правый → левый нападающий |

**Зеркалирование:** `finalX = 332 - x`

### Пример 3: Смена позиции LD → LB

**Было:** `['GK', 'LD', 'CD', 'CD', 'RD', ...]`  
**Стало:** `['GK', 'LB', 'CD', 'CD', 'RD', ...]`

**Результат:**

| Игрок | Было | Стало | Изменение |
|-------|------|-------|-----------|
| LD | line: def, x: 10, y: 450 | LB: line: semidef, x: 43, y: 400 | Сменил линию, но остался на левом фланге |
| CD #1 | line: def, x: 119, y: 450 | line: def, x: 119, y: 450 | Без изменений |
| CD #2 | line: def, x: 213, y: 450 | line: def, x: 213, y: 450 | Без изменений |
| RD | line: def, x: 322, y: 450 | line: def, x: 322, y: 450 | Без изменений |

**Ключевой момент:** LB остался на левом фланге (x: 43), а не переместился в центр (x: 166).

## Координатная сетка

### Ключевые X-координаты

```
0px          34px         166px        298px        366px        400px
|------------|------------|------------|------------|------------|
             |<--- Рабочая область 332px ----------->|
             
             20px         166px        312px
             |------------|------------|
             MIN_X        CENTER       MAX_X
             
             43px         119px  166px  213px        289px
             |------------|------|------|------------|
             LEFT(10%)    L-CTR  CENTER R-CTR        RIGHT(90%)
```

### Ключевые Y-координаты (домашняя команда)

```
0px
|
34px  ← Начало рабочей области
|
17px  ← MIN_Y (минимальная координата центра футболки)
|
...
|
265px ← att (атакующая линия)
310px ← semiatt (полуатакующая линия)
355px ← mid (средняя линия)
400px ← semidef (полузащитная линия)
450px ← def (защитная линия)
497px ← gk (вратарь)
|
481px ← MAX_Y (максимальная координата центра футболки)
|
532px ← Конец рабочей области (34 + 498)
|
566px
```

### Ключевые Y-координаты (гостевая команда)

```
0px
|
50px  ← Верхний край GK (эмпирический отступ)
67px  ← gk (вратарь) - центр футболки
84px  ← Нижний край GK
|
110px ← Верхний край def
127px ← def (защитная линия)
144px ← Нижний край def
|
140px ← Верхний край semidef
157px ← semidef (полузащитная линия)
174px ← Нижний край semidef
|
185px ← Верхний край mid
202px ← mid (средняя линия)
219px ← Нижний край mid
|
215px ← Верхний край semiatt
232px ← semiatt (полуатакующая линия)
249px ← Нижний край semiatt
|
260px ← Верхний край att
277px ← att (атакующая линия)
294px ← Нижний край att
|
═══════ ЗАЗОР 28px ═══════
|
322px ← Верхний край att (хозяева)
```

**Примечание:** Гостевой GK имеет отступ 50px от верха поля (вместо теоретических 0px) для корректного отображения в браузере.

## Исправленные проблемы

### ❌ Проблема 1: Выход за верхнюю границу (ИСПРАВЛЕНО)

**Было:**
```javascript
zones.gk = 17; // Гостевой вратарь
// Центр на 17px → верхний край на 0px
// Выходит за границу из-за особенностей рендеринга
```

**Стало:**
```javascript
zones.gk = 67; // Гостевой вратарь
// Центр на 67px → верхний край на 50px
// Эмпирически подобранное значение ✅
```

**Причина:** При теоретически правильном значении `gk: 17` футболка выходит за верхнюю границу поля из-за особенностей рендеринга браузера, CSS overflow или округления координат. Значение `gk: 67` (отступ 50px) обеспечивает корректное визуальное отображение.

### ❌ Проблема 2: Выход за боковые границы (ИСПРАВЛЕНО)

**Было:**
```javascript
left: 41.2px
// Центр на 41.2px → левый край на 21.2px (41.2 - 20)
// Контейнер начинается с 34px
// Выход за границу на ~13px
```

**Стало:**
```javascript
// Применяются ограничения
pos.left = Math.max(MIN_X, Math.min(MAX_X, pos.left));
// MIN_X = 20px, поэтому минимальная координата центра = 20px
// Левый край = 0px (20 - 20) - на границе контейнера ✅
```

### ⚠️ Проблема 3: Пересечения футболок (ИСПРАВЛЕНО)

**Было:**
- Минимальное расстояние между линиями: 45-50px
- Футболки высотой 34px могли пересекаться

**Стало:**
- Минимальное расстояние между линиями: 50px
- Гарантированный зазор: 16px (50 - 34 = 16px)
- Пересечения исключены ✅

## Диагностика и отладка

### Включение логирования

Система включает подробное логирование:

```javascript
console.log('[FlankPositioning] Генерация позиций для home:', formation);
console.log('[FlankPositioning] Игрок 1: LD -> фланг: left');
console.log('[FlankPositioning] Линия def:', [
    "LD(left) -> x:10 -> final:10",
    "CD(center) -> x:119 -> final:119"
]);
console.log('[FlankPositioning] Итоговые позиции:', positions);
console.log('[FlankPositioning] Позиции после ограничений:', positions);
```

### Отладочная сетка

Для визуальной отладки доступна функция `window.debugFieldGrid()`:

```javascript
// В консоли браузера
window.debugFieldGrid(); // Показать сетку
window.debugFieldGrid(); // Скрыть сетку
```

**Отображает:**
- Красные линии - зоны Y (gk, def, mid, att и т.д.)
- Синие линии - ключевые координаты X (левый край, центр, правый край)

## Версия

Текущая версия системы: **0.932**

**История изменений:**
- **0.929:** Удалены эффекты при наведении на футболки
- **0.930:** Исправлено позиционирование (границы и расстояния между линиями)
- **0.931:** Добавлена константа `FIELD_LAYOUT` для централизованного управления размерами и отступами
- **0.932:** Убраны отступы контейнера (CONTAINER_PADDING = 0), пересчитаны все зоны для рабочей области 400×566px

## Текущие координаты зон

### Домашняя команда (снизу вверх):
```
gk: 549      (границы: 532-566) ✅ Прижат к низу
def: 499     (границы: 482-516)
semidef: 475 (границы: 458-492)
mid: 449     (границы: 432-466)
semiatt: 424 (границы: 407-441)
att: 339     (границы: 322-356)
```

### Гостевая команда (сверху вниз):
```
gk: 67       (границы: 50-84)   ⚠️ Отступ 50px от верха
def: 127     (границы: 110-144)
semidef: 157 (границы: 140-174)
mid: 202     (границы: 185-219)
semiatt: 232 (границы: 215-249)
att: 277     (границы: 260-294)
```

### Проверка пересечений:
- **GK:** Зазор 532 - 84 = 448px ✅
- **att:** Зазор 322 - 294 = 28px ✅ Нет пересечений
- **Все линии:** Нет пересечений ✅

## Константа FIELD_LAYOUT

Все магические числа теперь вынесены в единую константу:

```javascript
const FIELD_LAYOUT = {
    FIELD_WIDTH: 400,           // Ширина внешнего контейнера
    FIELD_HEIGHT: 566,          // Высота внешнего контейнера
    CONTAINER_PADDING: 34,      // Отступы (выбрано эмпирически)
    WORKING_WIDTH: 332,         // 400 - 34*2
    WORKING_HEIGHT: 498,        // 566 - 34*2
    SHIRT_WIDTH: 40,            // Ширина футболки
    SHIRT_HEIGHT: 34,           // Высота футболки
    SHIRT_HALF_WIDTH: 20,       // Для центрирования
    SHIRT_HALF_HEIGHT: 17       // Для центрирования
};
```

**Преимущества:**
- Все размеры в одном месте
- Легко изменить отступы или размеры футболок
- Автоматический пересчёт зависимых значений
- Улучшенная читаемость кода

## Связанные файлы

- `calc.user.js` - основной файл с функциями позиционирования
- `docs/FLANK_POSITIONING_SYSTEM.md` - документация по фланговой системе
- `docs/BUGFIX_SHIRT_POSITIONING.md` - отчет об исправлении позиционирования
- `docs/FIELD_POSITIONING_ANALYSIS.md` - анализ проблем позиционирования

## Заключение

Система позиционирования футболок обеспечивает:

1. ✅ **Корректное отображение** - футболки не выходят за границы поля
2. ✅ **Отсутствие пересечений** - минимальные расстояния между игроками
3. ✅ **Фланговая логика** - фланговые игроки остаются на флангах
4. ✅ **Зеркалирование** - корректное отображение для обеих команд
5. ✅ **Гибкость** - поддержка любых формаций
6. ✅ **Отладка** - подробное логирование и визуальная сетка
