# Инструкции по тестированию подсказок для футболок

## Обновления в коде

### Изменение 1: Добавлен `pointer-events: auto` для футболок
```javascript
div.style.cssText = `
    ...
    cursor: pointer;
    pointer-events: auto;  // ← ДОБАВЛЕНО
    z-index: 10;
    ...
`;
```

Это гарантирует, что футболки будут кликабельны даже если родительский элемент имеет другие CSS свойства.

## Инструкции для тестирования

### Шаг 1: Обновите userscript
1. Откройте Tampermonkey/Greasemonkey
2. Найдите скрипт "Virtual Soccer Strength Analyzer"
3. Обновите скрипт до последней версии (или скопируйте новый код из `calc.user.js`)
4. Сохраните изменения

### Шаг 2: Откройте страницу матча
1. Перейдите на https://www.virtualsoccer.ru/previewmatch.php
2. Откройте консоль браузера (F12 → вкладка Console)
3. Обновите страницу (F5)

### Шаг 3: Проверьте инициализацию
В консоли должны появиться сообщения:
```
[FieldHints] displayShirtsOnField вызвана
[FieldHints] homeLineup: Array(11) [...]
[FieldHints] awayLineup: Array(11) [...]
[FieldHints] Создание футболки: ID=shirt-home-GK-..., позиция=GK, команда=home, игрок=null, есть данные=false
... (всего 22 футболки)
```

✅ **Если сообщения есть** → система инициализирована правильно
❌ **Если сообщений нет** → userscript не загрузился или не работает на этой странице

### Шаг 4: Тест кликов БЕЗ выбранных игроков

1. **НЕ выбирайте игроков** в селекторах
2. **Кликните на любую футболку** на поле (домашняя или гостевая команда)
3. Проверьте консоль - должно появиться:
   ```
   [FieldHints] Клик по футболке: shirt-home-GK-..., позиция: GK, команда: home
   [FieldHints] Показываем подсказку только для позиции: GK
   [FieldHints] showFieldPlayerHint вызвана
   [FieldHints] position: GK
   [FieldHints] team: home
   [FieldHints] playerData: null
   ```

4. **Должна появиться подсказка** с информацией о позиции:
   - Название позиции (например, "Вратарь")
   - Линия (например, "Вратарская линия")
   - Описание позиции
   - Сообщение "Игрок не выбран"

**Результаты:**
- ✅ **Подсказка появилась** → система работает! Переходите к Шагу 5
- ❌ **Логи есть, но подсказка не появилась** → проблема в функции `showFieldPlayerHint` или CSS
- ❌ **Логов о клике нет** → футболка не кликабельна, см. "Диагностика проблем"

### Шаг 5: Тест кликов С выбранными игроками

1. **Выберите игроков** в селекторах для нескольких позиций (например, GK, LD, CM, CF)
2. Проверьте консоль - должны появиться новые сообщения:
   ```
   [FieldHints] displayShirtsOnField вызвана
   [FieldHints] Домашняя команда - позиция GK: игрок Иван Иванов, данные: {...}
   [FieldHints] Создание футболки: ID=shirt-home-GK-..., позиция=GK, команда=home, игрок=Иван Иванов, есть данные=true
   ```

3. **Кликните на футболку выбранного игрока**
4. Проверьте консоль:
   ```
   [FieldHints] Клик по футболке: shirt-home-GK-..., позиция: GK, команда: home
   [FieldHints] Показываем подсказку для игрока: Иван Иванов
   [FieldHints] showFieldPlayerHint вызвана
   ```

5. **Должна появиться подсказка** с полной информацией об игроке:
   - Имя игрока и возраст
   - Базовая сила
   - Расчетная сила (с учетом всех модификаторов)
   - Общий вклад в команду
   - Модификаторы силы (физ. форма, усталость, позиция, реальность)
   - Вклад в команду (капитан, синергия, химия, настрой, атмосфера и т.д.)

**Результаты:**
- ✅ **Подсказка с данными игрока появилась** → система полностью работает!
- ⚠️ **Подсказка появилась, но без данных игрока** → проблема в передаче `playerData`
- ❌ **Подсказка не появилась** → см. "Диагностика проблем"

## Диагностика проблем

### Проблема 1: Логов о клике нет

**Симптомы:**
- Кликаете на футболку, но в консоли нет сообщения `[FieldHints] Клик по футболке:`

**Возможные причины:**
1. Футболка перекрыта другим элементом
2. CSS свойство блокирует клики
3. Обработчик события не добавлен

**Решение:**
1. Откройте инспектор элементов (F12 → Elements/Инспектор)
2. Найдите элемент футболки (должен иметь ID вида `shirt-home-GK-...`)
3. Проверьте CSS свойства:
   - `cursor: pointer` ✅
   - `pointer-events: auto` ✅
   - `z-index: 10` ✅
4. Проверьте, нет ли элементов с большим z-index поверх футболки
5. Попробуйте кликнуть на футболку через консоль:
   ```javascript
   document.getElementById('shirt-home-GK-...').click();
   ```

### Проблема 2: Подсказка не появляется

**Симптомы:**
- Логи о клике есть, но подсказка не появляется на экране

**Возможные причины:**
1. Ошибка JavaScript в функции `showFieldPlayerHint`
2. CSS проблема (z-index, display, position)
3. Подсказка создается, но за пределами видимой области

**Решение:**
1. Проверьте консоль на наличие ошибок JavaScript (красные сообщения)
2. Найдите элемент подсказки в инспекторе:
   - Класс: `vs-field-player-hint` или `vs-field-position-hint`
   - Должен иметь `position: fixed` и `z-index: 10000`
3. Проверьте, не выходит ли подсказка за границы экрана
4. Попробуйте вызвать функцию вручную:
   ```javascript
   showFieldPlayerHint('GK', 'home', null, document.getElementById('shirt-home-GK-...'));
   ```

### Проблема 3: Данные игрока не передаются

**Симптомы:**
- Игрок выбран в селекторе
- Но подсказка показывает "Игрок не выбран"
- В логах: `есть данные=false`

**Возможные причины:**
1. `homeLineup[idx].getValue()` возвращает пустую строку
2. `homeLineup[idx].selectedPlayer` отсутствует
3. Индекс не совпадает с позицией

**Решение:**
1. Проверьте структуру lineup в консоли:
   ```javascript
   console.log(window.homeLineupBlock.lineup[0]);
   ```
2. Проверьте метод getValue:
   ```javascript
   console.log(window.homeLineupBlock.lineup[0].getValue());
   ```
3. Проверьте selectedPlayer:
   ```javascript
   console.log(window.homeLineupBlock.lineup[0].selectedPlayer);
   ```

## Ожидаемые результаты

### Успешный тест:

1. ✅ Футболки отображаются на поле
2. ✅ При клике на футболку появляются логи в консоли
3. ✅ Подсказка появляется на экране
4. ✅ Для выбранных игроков показываются полные данные
5. ✅ Для невыбранных позиций показывается информация о позиции

### Если что-то не работает:

1. Скопируйте **все логи из консоли** (от начала загрузки страницы до клика)
2. Сделайте **скриншот** страницы с открытой консолью
3. Опишите **что именно не работает**:
   - Футболки не отображаются?
   - Клик не срабатывает?
   - Подсказка не появляется?
   - Данные игрока не показываются?

## Дополнительная информация

### Горячие клавиши:
- **F12** - открыть консоль разработчика
- **F5** - обновить страницу
- **Ctrl+Shift+C** - инспектор элементов

### Полезные команды в консоли:
```javascript
// Проверить, загружен ли userscript
console.log(typeof initializeFieldHints);  // должно быть "function"

// Проверить lineup
console.log(window.homeLineupBlock);
console.log(window.awayLineupBlock);

// Найти все футболки
document.querySelectorAll('[id^="shirt-"]');

// Принудительно показать подсказку
showFieldPlayerHint('GK', 'home', null, document.querySelector('[id^="shirt-home-GK"]'));
```